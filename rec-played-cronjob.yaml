apiVersion: batch/v1
kind: CronJob
metadata:
  name: recently-played-updater
spec:
  schedule: "30 9,12,20 * * *"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: recently-played
            image: nginx:latest
            imagePullPolicy: IfNotPresent
            command:
            - curl
            - -X 
            - POST 
            - http://rec-played:8000/auto-update
            env:
            - name: CLIENT_ID
              valueFrom:
                secretKeyRef:
                  name: played-secrets
                  key: spotify-client-id
            
            - name: CLIENT_SECRET
              valueFrom:
                secretKeyRef:
                  name: played-secrets
                  key: spotify-client-secret
            
            - name: STRAVA_CLIENT_ID
              valueFrom:
                secretKeyRef:
                  name: played-secrets
                  key: strava-client-id
            
            - name: STRAVA_SECRET
              valueFrom:
                secretKeyRef:
                  name: played-secrets
                  key: strava-secret
            
            - name: URL
              valueFrom:
                secretKeyRef:
                  name: played-secrets
                  key: strava-url
            
            - name: CODE
              valueFrom:
                secretKeyRef:
                  name: played-secrets
                  key: strava-code
          
          restartPolicy: OnFailure